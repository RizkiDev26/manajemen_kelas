<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Filter Siswa - Halaman Input Absensi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .test-result {
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 0.5rem;
            border: 1px solid;
        }
        .test-pass {
            background-color: #dcfce7;
            border-color: #16a34a;
            color: #15803d;
        }
        .test-fail {
            background-color: #fee2e2;
            border-color: #dc2626;
            color: #dc2626;
        }
        .test-info {
            background-color: #dbeafe;
            border-color: #2563eb;
            color: #1d4ed8;
        }
    </style>
</head>
<body class="bg-gray-100 p-6">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Pengujian Filter Siswa - Input Absensi</h1>
        
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Hasil Pengujian</h2>
            <div id="testResults"></div>
            
            <button id="runTests" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold mt-4">
                Jalankan Pengujian Filter Siswa
            </button>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-4">Simulasi Data Siswa</h2>
            <div id="studentSimulation" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
        </div>
    </div>

    <script>
        // Simulasi data siswa untuk pengujian
        const mockStudents = [
            { id: 1, nama: 'Ahmad Rizki', nisn: '1234567890', status: 'hadir', jk: 'L' },
            { id: 2, nama: 'Siti Nurhaliza', nisn: '1234567891', status: 'sakit', jk: 'P' },
            { id: 3, nama: 'Budi Santoso', nisn: '1234567892', status: 'izin', jk: 'L' },
            { id: 4, nama: 'Dewi Sartika', nisn: '1234567893', status: 'alpha', jk: 'P' },
            { id: 5, nama: 'Andi Wijaya', nisn: '1234567894', status: '', jk: 'L' },
            { id: 6, nama: 'Maya Sari', nisn: '1234567895', status: 'hadir', jk: 'P' },
            { id: 7, nama: 'Rudi Hartono', nisn: '1234567896', status: '', jk: 'L' },
            { id: 8, nama: 'Lina Marlina', nisn: '1234567897', status: 'sakit', jk: 'P' }
        ];

        class FilterSiswaTest {
            constructor() {
                this.students = mockStudents;
                this.filteredStudents = [...this.students];
                this.testResults = [];
            }

            // Simulasi fungsi filter berdasarkan nama/NISN
            filterBySearch(query) {
                const normalizedQuery = query.toLowerCase().trim();
                if (!normalizedQuery) {
                    return [...this.students];
                }
                
                return this.students.filter(student => 
                    student.nama.toLowerCase().includes(normalizedQuery) ||
                    student.nisn.includes(normalizedQuery)
                );
            }

            // Simulasi fungsi filter berdasarkan status
            filterByStatus(status) {
                if (status === 'all') {
                    return [...this.students];
                }
                if (status === 'belum') {
                    return this.students.filter(student => !student.status || student.status === '');
                }
                return this.students.filter(student => student.status === status);
            }

            // Test 1: Filter pencarian nama
            testSearchByName() {
                const testCases = [
                    { query: 'ahmad', expected: 1, description: 'Pencarian "ahmad" (case insensitive)' },
                    { query: 'siti', expected: 1, description: 'Pencarian "siti"' },
                    { query: 'xyz', expected: 0, description: 'Pencarian nama yang tidak ada' },
                    { query: '', expected: 8, description: 'Pencarian kosong (tampilkan semua)' },
                    { query: 'a', expected: 3, description: 'Pencarian huruf "a" (partial match)' }
                ];

                let passed = 0;
                testCases.forEach(testCase => {
                    const result = this.filterBySearch(testCase.query);
                    const success = result.length === testCase.expected;
                    
                    this.testResults.push({
                        test: `Filter Nama: ${testCase.description}`,
                        expected: `${testCase.expected} siswa`,
                        actual: `${result.length} siswa`,
                        passed: success
                    });
                    
                    if (success) passed++;
                });

                return { passed, total: testCases.length };
            }

            // Test 2: Filter pencarian NISN
            testSearchByNISN() {
                const testCases = [
                    { query: '1234567890', expected: 1, description: 'Pencarian NISN lengkap' },
                    { query: '123456789', expected: 8, description: 'Pencarian NISN partial (9 digit pertama)' },
                    { query: '0', expected: 1, description: 'Pencarian digit terakhir "0"' },
                    { query: '999', expected: 0, description: 'Pencarian NISN yang tidak ada' }
                ];

                let passed = 0;
                testCases.forEach(testCase => {
                    const result = this.filterBySearch(testCase.query);
                    const success = result.length === testCase.expected;
                    
                    this.testResults.push({
                        test: `Filter NISN: ${testCase.description}`,
                        expected: `${testCase.expected} siswa`,
                        actual: `${result.length} siswa`,
                        passed: success
                    });
                    
                    if (success) passed++;
                });

                return { passed, total: testCases.length };
            }

            // Test 3: Filter berdasarkan status kehadiran
            testFilterByStatus() {
                const testCases = [
                    { status: 'all', expected: 8, description: 'Filter "Semua"' },
                    { status: 'hadir', expected: 2, description: 'Filter "Hadir"' },
                    { status: 'sakit', expected: 2, description: 'Filter "Sakit"' },
                    { status: 'izin', expected: 1, description: 'Filter "Izin"' },
                    { status: 'alpha', expected: 1, description: 'Filter "Alpha"' },
                    { status: 'belum', expected: 2, description: 'Filter "Belum Absen"' }
                ];

                let passed = 0;
                testCases.forEach(testCase => {
                    const result = this.filterByStatus(testCase.status);
                    const success = result.length === testCase.expected;
                    
                    this.testResults.push({
                        test: `Filter Status: ${testCase.description}`,
                        expected: `${testCase.expected} siswa`,
                        actual: `${result.length} siswa`,
                        passed: success
                    });
                    
                    if (success) passed++;
                });

                return { passed, total: testCases.length };
            }

            // Test 4: Kombinasi filter
            testCombinedFilters() {
                let passed = 0;
                let total = 0;

                // Test: Filter status "hadir" kemudian search "ahmad"
                const hadirStudents = this.filterByStatus('hadir');
                const combinedResult = hadirStudents.filter(student => 
                    student.nama.toLowerCase().includes('ahmad')
                );
                
                const success1 = combinedResult.length === 1;
                this.testResults.push({
                    test: 'Kombinasi Filter: Status "Hadir" + Pencarian "Ahmad"',
                    expected: '1 siswa',
                    actual: `${combinedResult.length} siswa`,
                    passed: success1
                });
                if (success1) passed++;
                total++;

                // Test: Filter "belum absen" kemudian search berdasarkan jenis kelamin
                const belumAbsen = this.filterByStatus('belum');
                const belumAbsenLaki = belumAbsen.filter(student => student.jk === 'L');
                
                const success2 = belumAbsenLaki.length === 2;
                this.testResults.push({
                    test: 'Kombinasi Filter: "Belum Absen" + Jenis Kelamin Laki-laki',
                    expected: '2 siswa',
                    actual: `${belumAbsenLaki.length} siswa`,
                    passed: success2
                });
                if (success2) passed++;
                total++;

                return { passed, total };
            }

            // Test 5: Performance dan edge cases
            testEdgeCases() {
                let passed = 0;
                let total = 0;

                // Test: Input dengan spasi
                const resultWithSpaces = this.filterBySearch('  ahmad  ');
                const success1 = resultWithSpaces.length === 1;
                this.testResults.push({
                    test: 'Edge Case: Pencarian dengan spasi di awal/akhir',
                    expected: '1 siswa',
                    actual: `${resultWithSpaces.length} siswa`,
                    passed: success1
                });
                if (success1) passed++;
                total++;

                // Test: Input dengan karakter khusus
                const resultSpecialChar = this.filterBySearch('ahmad@#$');
                const success2 = resultSpecialChar.length === 0;
                this.testResults.push({
                    test: 'Edge Case: Pencarian dengan karakter khusus',
                    expected: '0 siswa',
                    actual: `${resultSpecialChar.length} siswa`,
                    passed: success2
                });
                if (success2) passed++;
                total++;

                // Test: Input sangat panjang
                const longQuery = 'a'.repeat(100);
                const resultLongQuery = this.filterBySearch(longQuery);
                const success3 = resultLongQuery.length === 0;
                this.testResults.push({
                    test: 'Edge Case: Pencarian dengan string sangat panjang',
                    expected: '0 siswa',
                    actual: `${resultLongQuery.length} siswa`,
                    passed: success3
                });
                if (success3) passed++;
                total++;

                return { passed, total };
            }

            // Jalankan semua test
            runAllTests() {
                this.testResults = [];
                
                const nameTest = this.testSearchByName();
                const nisnTest = this.testSearchByNISN();
                const statusTest = this.testFilterByStatus();
                const combinedTest = this.testCombinedFilters();
                const edgeTest = this.testEdgeCases();

                const totalPassed = nameTest.passed + nisnTest.passed + statusTest.passed + combinedTest.passed + edgeTest.passed;
                const totalTests = nameTest.total + nisnTest.total + statusTest.total + combinedTest.total + edgeTest.total;

                return {
                    totalPassed,
                    totalTests,
                    results: this.testResults
                };
            }

            // Render hasil test
            renderResults(results) {
                const container = document.getElementById('testResults');
                container.innerHTML = '';

                // Summary
                const summary = document.createElement('div');
                summary.className = `test-result ${results.totalPassed === results.totalTests ? 'test-pass' : 'test-fail'}`;
                summary.innerHTML = `
                    <h3 class="font-bold text-lg mb-2">Ringkasan Pengujian</h3>
                    <p><strong>Total Test:</strong> ${results.totalTests}</p>
                    <p><strong>Berhasil:</strong> ${results.totalPassed}</p>
                    <p><strong>Gagal:</strong> ${results.totalTests - results.totalPassed}</p>
                    <p><strong>Tingkat Keberhasilan:</strong> ${((results.totalPassed / results.totalTests) * 100).toFixed(1)}%</p>
                `;
                container.appendChild(summary);

                // Detail results
                results.results.forEach(result => {
                    const div = document.createElement('div');
                    div.className = `test-result ${result.passed ? 'test-pass' : 'test-fail'}`;
                    div.innerHTML = `
                        <h4 class="font-semibold">${result.test}</h4>
                        <p><strong>Diharapkan:</strong> ${result.expected}</p>
                        <p><strong>Hasil:</strong> ${result.actual}</p>
                        <p><strong>Status:</strong> ${result.passed ? '✅ BERHASIL' : '❌ GAGAL'}</p>
                    `;
                    container.appendChild(div);
                });
            }

            // Render simulasi data siswa
            renderStudentSimulation() {
                const container = document.getElementById('studentSimulation');
                container.innerHTML = '';

                this.students.forEach(student => {
                    const div = document.createElement('div');
                    div.className = 'bg-gray-50 p-4 rounded-lg border';
                    
                    const statusColor = {
                        'hadir': 'text-green-600',
                        'sakit': 'text-yellow-600',
                        'izin': 'text-blue-600',
                        'alpha': 'text-red-600',
                        '': 'text-gray-500'
                    };

                    div.innerHTML = `
                        <h4 class="font-semibold text-gray-800">${student.nama}</h4>
                        <p class="text-sm text-gray-600">NISN: ${student.nisn}</p>
                        <p class="text-sm text-gray-600">Jenis Kelamin: ${student.jk === 'L' ? 'Laki-laki' : 'Perempuan'}</p>
                        <p class="text-sm ${statusColor[student.status]}">
                            Status: ${student.status || 'Belum Absen'}
                        </p>
                    `;
                    container.appendChild(div);
                });
            }
        }

        // Initialize test
        const filterTest = new FilterSiswaTest();
        
        // Render student simulation
        filterTest.renderStudentSimulation();

        // Run tests when button clicked
        document.getElementById('runTests').addEventListener('click', () => {
            const results = filterTest.runAllTests();
            filterTest.renderResults(results);
        });

        // Auto run tests on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                const results = filterTest.runAllTests();
                filterTest.renderResults(results);
            }, 500);
        });
    </script>
</body>
</html>
